* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

html {
    width: 100%;
    overflow-x: hidden;
}

body {
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: #0d0b0e;
    overflow: hidden;
    touch-action: none;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: max(12px, env(safe-area-inset-top)) max(12px, env(safe-area-inset-right)) max(12px, env(safe-area-inset-bottom)) max(12px, env(safe-area-inset-left));
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.leaves {
    position: fixed;
    inset: 0;
    z-index: 0.5;
    pointer-events: none;
    overflow: hidden;
}

.leaf {
    position: absolute;
    font-size: clamp(18px, 3vw, 28px);
    opacity: 0.5;
    animation: var(--anim, leafFloat) var(--dur, 15s) linear var(--delay, 0s) infinite var(--dir, normal);
}
.leaf:nth-child(even) { --anim: leafFloatReverse; }
.leaf:nth-child(1) { top: 10%; --dur: 18s; --delay: 0s; --dir: normal; }
.leaf:nth-child(2) { top: 25%; --dur: 22s; --delay: -4s; --dir: reverse; }
.leaf:nth-child(3) { top: 45%; --dur: 16s; --delay: -2s; --dir: normal; }
.leaf:nth-child(4) { top: 60%; --dur: 20s; --delay: -7s; --dir: reverse; }
.leaf:nth-child(5) { top: 75%; --dur: 19s; --delay: -1s; --dir: normal; }
.leaf:nth-child(6) { top: 88%; --dur: 24s; --delay: -10s; --dir: reverse; }
.leaf:nth-child(7) { top: 18%; --dur: 21s; --delay: -5s; --dir: reverse; }
.leaf:nth-child(8) { top: 35%; --dur: 17s; --delay: -8s; --dir: normal; }
.leaf:nth-child(9) { top: 52%; --dur: 23s; --delay: -3s; --dir: reverse; }
.leaf:nth-child(10) { top: 68%; --dur: 15s; --delay: -6s; --dir: normal; }
.leaf:nth-child(11) { top: 82%; --dur: 20s; --delay: -12s; --dir: reverse; }
.leaf:nth-child(12) { top: 5%; --dur: 26s; --delay: -9s; --dir: normal; }

@keyframes leafFloat {
    0% { left: -25%; transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(-30px) rotate(90deg); }
    50% { transform: translateY(20px) rotate(180deg); }
    75% { transform: translateY(-15px) rotate(270deg); }
    100% { left: 125%; transform: translateY(0) rotate(360deg); }
}

.leaf:nth-child(even) {
    animation-name: leafFloatReverse;
}

@keyframes leafFloatReverse {
    0% { left: 125%; transform: translateY(0) rotate(0deg); }
    25% { transform: translateY(25px) rotate(-90deg); }
    50% { transform: translateY(-20px) rotate(-180deg); }
    75% { transform: translateY(15px) rotate(-270deg); }
    100% { left: -25%; transform: translateY(0) rotate(-360deg); }
}

.game-panel {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: min(600px, calc(100vw - 24px));
    width: 100%;
}

.panel-square {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 100%;
}

.panel-overlay {
    position: absolute;
    inset: 0;
    border-radius: 20px;
    background: rgba(28, 24, 32, 0.92);
    pointer-events: none;
    z-index: 0;
}

#c {
    display: block;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0,0,0,.5), 0 0 0 1px rgba(255,255,255,.06);
    background: rgba(36, 30, 42, 0.6);
    position: relative;
    z-index: 1;
    margin: 0 auto;
    max-width: 100%;
}

#ui {
    position: absolute;
    top: 14px;
    left: 0;
    right: 0;
    padding: 0 16px;
    color: #f0eade;
    font-size: clamp(12px, 2.6vw, 14px);
    font-weight: 500;
    text-shadow: 0 2px 8px rgba(0,0,0,.8);
    text-align: center;
    z-index: 10;
    pointer-events: none;
    letter-spacing: 0.02em;
}

#s {
    font-size: clamp(24px, 5.5vw, 32px);
    font-weight: 700;
    margin-bottom: 4px;
    letter-spacing: 0.04em;
    color: #fff5e6;
}

#coins-wrap {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 4px;
}

#coins {
    font-size: clamp(13px, 2.8vw, 15px);
    font-weight: 600;
    color: #ffd166;
}

#coins-gain {
    font-size: clamp(12px, 2.5vw, 14px);
    color: #86efac;
    font-weight: 700;
    opacity: 0;
    transition: opacity .2s;
    letter-spacing: 0.05em;
    margin-left: 14px;
}

#coins-gain.show {
    opacity: 1;
    animation: coinsGainPop .6s ease-out forwards;
}

#coins-gain.lucky {
    background: linear-gradient(90deg, #f00, #f80, #ff0, #0f0, #0ff, #08f, #f0f, #f00);
    background-size: 400% 100%;
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
    color: transparent;
    animation: coinsGainPop .6s ease-out forwards, rainbowText .25s linear infinite;
}

@keyframes rainbowText {
    0% { background-position: 0% 50%; }
    100% { background-position: 400% 50%; }
}

@keyframes coinsGainPop {
    0% { transform: scale(1.2); opacity: 1; }
    15% { opacity: 0.88; }
    30% { opacity: 1; }
    45% { transform: scale(1); opacity: 0.92; }
    60% { opacity: 1; }
    75% { opacity: 0.85; }
    100% { transform: scale(1); opacity: 0; }
}

#a {
    font-size: clamp(11px, 2.3vw, 13px);
    font-weight: 500;
    opacity: .9;
    margin-bottom: 2px;
    color: #e8dfd0;
}

#t {
    font-size: clamp(11px, 2.2vw, 12px);
    font-weight: 500;
    opacity: .85;
    margin-bottom: 0;
    color: #ddd5c4;
}

#cut-popup {
    position: fixed;
    top: 42%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 16px;
    font-weight: 600;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #f5ead8;
    text-shadow: 0 2px 6px rgba(0,0,0,.7);
    padding: 8px 18px;
    background: rgba(45, 27, 61, 0.9);
    border-radius: 12px;
    pointer-events: none;
    opacity: 0;
    z-index: 15;
    letter-spacing: 0.04em;
    border: 1px solid rgba(255,255,255,.08);
}
#cut-popup.lucky {
    border: 2px solid transparent;
    background: linear-gradient(rgba(45, 27, 61, 0.95), rgba(45, 27, 61, 0.95)) padding-box,
        linear-gradient(90deg, #f00, #f80, #ff0, #0f0, #0ff, #08f, #f0f, #f00) border-box;
    background-size: 100% 100%, 400% 100%;
    background-origin: border-box;
    background-clip: padding-box, border-box;
}
#cut-popup.show {
    animation: cutPopup 1.8s ease-out forwards;
}
#cut-popup.show.lucky {
    animation: cutPopup 1.8s ease-out forwards, rainbowCutBorder 0.5s linear infinite;
}
@keyframes rainbowCutBorder {
    0% { background-position: 0% 50%, 0% 50%; }
    100% { background-position: 0% 50%, 400% 50%; }
}
@keyframes cutPopup {
    0% { opacity: 0; transform: translate(-50%, -50%) scale(0.92); }
    12% { opacity: 1; transform: translate(-50%, -50%) scale(1); }
    80% { opacity: 1; }
    100% { opacity: 0; transform: translate(-50%, -50%) scale(1); }
}

.overlay { position: fixed; inset: 0; background: rgba(0,0,0,.8); display: flex; align-items: center; justify-content: center; z-index: 100; opacity: 0; pointer-events: none; transition: opacity .3s ease; }
#instructions-overlay.overlay { overflow-y: auto; padding: 20px; }
.overlay.show { opacity: 1; pointer-events: auto; }

#instructions-panel {
    padding: 20px;
    background: #2d1b3d;
    border: 2px solid rgba(232,213,183,.3);
    border-radius: 16px;
    max-width: 380px;
    width: 90%;
    display: flex;
    flex-direction: column;
}

#instructions-panel h3 {
    color: #ffd166;
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 12px;
    text-align: center;
}

.instructions-content {
    margin-bottom: 16px;
}

#instructions-panel p {
    color: #e8dfd0;
    font-size: 13px;
    line-height: 1.6;
    margin-bottom: 12px;
}

#instructions-panel p:last-child {
    margin-bottom: 0;
}

#instructions-panel strong {
    color: #ffd166;
    font-weight: 600;
}

#instructions-panel em {
    color: #ffd166;
    font-style: normal;
}

#close-instructions {
    display: block;
    width: 100%;
    padding: 10px;
    font-size: 13px;
    background: rgba(76,175,80,.3);
    border-color: rgba(76,175,80,.5);
}

#pf {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 52px;
    font-weight: 700;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    color: #ffd166;
    text-shadow: 0 0 24px rgba(255,209,102,.7), 0 2px 8px rgba(0,0,0,.5);
    opacity: 0;
    pointer-events: none;
    transition: opacity .3s;
    letter-spacing: 0.06em;
}

#pf.show {
    opacity: 1;
    animation: float 1s ease-out;
}

@keyframes pulse {
    0%, 100% { 
        opacity: .5; 
    }
    50% { 
        opacity: .3; 
    }
}

@keyframes float {
    0% { 
        transform: translate(-50%, -50%) scale(.5); 
    }
    100% { 
        transform: translate(-50%, -100%) scale(1.2); 
        opacity: 0; 
    }
}

#menu {
    position: fixed;
    top: max(12px, env(safe-area-inset-top));
    right: max(12px, env(safe-area-inset-right));
    left: max(12px, env(safe-area-inset-left));
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: flex-end;
    z-index: 10;
    padding: 0 4px;
}

button {
    background: rgba(232,213,183,.12);
    border: 2px solid rgba(232,213,183,.25);
    color: #f0e6d8;
    padding: 10px 20px;
    min-height: 44px;
    min-width: 44px;
    border-radius: 14px;
    cursor: pointer;
    font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    font-size: 13px;
    font-weight: 600;
    letter-spacing: 0.03em;
    backdrop-filter: blur(12px);
    transition: all .25s ease;
}

button:hover {
    background: rgba(232,213,183,.25);
}

button:active {
    transform: scale(.95);
}

button:disabled {
    opacity: .5;
    cursor: not-allowed;
}


#shop.show.just-opened #shop-content {
    animation: shopSlideIn .4s cubic-bezier(0.34, 1.56, 0.64, 1) forwards;
}

@keyframes shopSlideIn {
    0% {
        opacity: 0;
        transform: translateY(30px) scale(0.95);
    }
    100% {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

#shop-content {
    position: relative;
    background: #2d1b3d;
    border: 3px solid rgba(232,213,183,.3);
    border-radius: 20px;
    padding: 20px;
    max-width: 500px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    scrollbar-width: none;
    -ms-overflow-style: none;
    margin: max(env(safe-area-inset-top), 12px) max(env(safe-area-inset-right), 12px) max(env(safe-area-inset-bottom), 12px) max(env(safe-area-inset-left), 12px);
}

#shop-content::-webkit-scrollbar {
    display: none;
}

.shop-close-x {
    position: absolute;
    top: 4px;
    right: 4px;
    width: 48px;
    height: 48px;
    min-width: 48px;
    min-height: 48px;
    padding: 0;
    margin: 0;
    font-size: 28px;
    line-height: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    color: rgba(232,213,183,.8);
    background: rgba(255,255,255,.06);
    border: 2px solid rgba(232,213,183,.25);
    cursor: pointer;
    border-radius: 12px;
    z-index: 10;
    touch-action: manipulation;
}

.shop-close-x:hover {
    color: #ffd166;
    background: rgba(255,255,255,.12);
    border-color: rgba(232,213,183,.4);
}

#shop-content h2 {
    color: #ffd166;
    margin-bottom: 18px;
    text-align: center;
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 0.04em;
}

#shop.show #shop-content h2 {
    opacity: 1;
    transform: translateY(0);
}

#shop.show.just-opened #shop-content h2 {
    opacity: 0;
    transform: translateY(-10px) scale(0.9);
    animation: shopTitleIn .4s cubic-bezier(0.34, 1.56, 0.64, 1) .02s forwards;
}

@keyframes shopTitleIn {
    0% { opacity: 0; transform: translateY(-10px) scale(0.9); }
    100% { opacity: 1; transform: translateY(0) scale(1); }
}

.upgrade {
    background: rgba(232,213,183,.1);
    border: 2px solid rgba(232,213,183,.2);
    border-radius: 10px;
    padding: 12px;
    margin-bottom: 10px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    transform-origin: left center;
    transition: transform .2s ease, border-color .2s ease, background .2s ease;
}

.upgrade-emoji {
    font-size: 36px;
    line-height: 1;
    margin-right: 12px;
    flex-shrink: 0;
}

.upgrade-with-img {
    gap: 8px;
}

#shop.show.just-opened .upgrade {
    animation: itemPopIn .35s cubic-bezier(0.34, 1.56, 0.64, 1) backwards;
}

#shop.show.just-opened .upgrade:nth-child(1) { animation-delay: .08s; }
#shop.show.just-opened .upgrade:nth-child(2) { animation-delay: .12s; }
#shop.show.just-opened .upgrade:nth-child(3) { animation-delay: .16s; }
#shop.show.just-opened .upgrade:nth-child(4) { animation-delay: .2s; }
#shop.show.just-opened .upgrade:nth-child(5) { animation-delay: .24s; }
#shop.show.just-opened .upgrade:nth-child(6) { animation-delay: .28s; }
#shop.show.just-opened .upgrade:nth-child(n+7) { animation-delay: .32s; }

@keyframes itemPopIn {
    0% { opacity: 0; transform: translateX(-15px) scale(0.9); }
    100% { opacity: 1; transform: translateX(0) scale(1); }
}

.upgrade:hover {
    transform: translateX(4px);
    border-color: rgba(232,213,183,.35);
    background: rgba(232,213,183,.15);
}

.upgrade.bought {
    opacity: .5;
}

.upgrade > div {
    flex: 1;
}

.upgrade h3 {
    color: #f0e6d8;
    font-size: 15px;
    font-weight: 600;
    margin-bottom: 4px;
    letter-spacing: 0.02em;
}

.upgrade p {
    color: #e0d8cc;
    opacity: .9;
    font-size: 12px;
    margin-bottom: 6px;
    font-weight: 500;
    line-height: 1.35;
}

.price {
    color: #ffd166;
    font-weight: 700;
    margin-right: 10px;
    font-size: 13px;
}

.price-sale .sale-price {
    color: #86efac;
    font-size: 14px;
}

.price-sale .original-price {
    font-size: 11px;
    color: rgba(255,209,102,.5);
    text-decoration: line-through;
}

.buy-btn {
    padding: 6px 14px;
    font-size: 11px;
    background: rgba(76,175,80,.3);
    border-color: rgba(76,175,80,.5);
}

.buy-btn:disabled {
    opacity: .3;
    cursor: not-allowed;
}

.category {
    color: #ffd166;
    font-size: 16px;
    font-weight: 600;
    margin: 18px 0 10px;
    padding-bottom: 6px;
    border-bottom: 1px solid rgba(232,213,183,.25);
    letter-spacing: 0.03em;
}

#shop.show .category {
    opacity: 1;
    transform: translateY(0);
}

#shop.show.just-opened .category {
    opacity: 0;
    transform: translateY(-5px);
    animation: categoryFadeIn .3s ease forwards;
}

#shop.show.just-opened .category:nth-of-type(1) { animation-delay: .05s; }
#shop.show.just-opened .category:nth-of-type(2) { animation-delay: .15s; }
#shop.show.just-opened .category:nth-of-type(3) { animation-delay: .25s; }

@keyframes categoryFadeIn {
    0% { opacity: 0; transform: translateY(-5px); }
    100% { opacity: 1; transform: translateY(0); }
}

#close-shop {
    margin-top: 15px;
    width: 100%;
    background: rgba(244,67,54,.3);
    border-color: rgba(244,67,54,.5);
}

#shop.show #close-shop {
    opacity: 1;
}

#shop.show.just-opened #close-shop {
    opacity: 0;
    animation: itemPopIn .3s ease .35s forwards;
}

@media (max-width: 480px) {
    body {
        --safe-x: max(8px, env(safe-area-inset-left), env(safe-area-inset-right));
        padding: max(8px, env(safe-area-inset-top)) var(--safe-x) max(80px, env(safe-area-inset-bottom)) var(--safe-x);
        overflow-y: auto;
        overflow-x: hidden;
        align-items: flex-start;
        justify-content: flex-start;
        -webkit-overflow-scrolling: touch;
    }
    
    .game-panel {
        max-width: 100%;
        flex: 0 0 auto;
        margin: 0 auto;
        align-self: stretch;
        width: 100%;
        padding-bottom: 12px;
    }
    
    #menu {
        top: auto;
        bottom: max(8px, env(safe-area-inset-bottom));
        right: var(--safe-x);
        left: var(--safe-x);
        gap: 6px;
        justify-content: center;
        flex-wrap: wrap;
    }
    
    
    button {
        padding: 10px 14px;
        font-size: 12px;
    }
    
    #shop-content {
        width: calc(100% - 24px);
        padding: 16px;
        margin: max(env(safe-area-inset-top), 8px) 12px max(env(safe-area-inset-bottom), 8px) 12px;
    }
    
    .upgrade {
        padding: 10px;
        gap: 8px;
    }
    
    .upgrade > div {
        min-width: 0;
    }
    
    .upgrade h3 {
        font-size: 14px;
    }
    
    .upgrade p {
        font-size: 11px;
    }
    
    .upgrade .price {
        flex-shrink: 0;
        font-size: 12px;
    }
    
    .buy-btn {
        padding: 8px 12px;
        font-size: 11px;
        min-height: 44px;
    }
    
    #ui {
        padding: 0 12px;
    }
    
    #s {
        font-size: 20px;
    }
}